{"ast":null,"code":"import{useEffect,useRef,useState}from'react';import classNames from'classnames';import{deleteTodo,updateTodo as updateTodoAPI}from'../api/todos';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const TodoItem=_ref=>{let{todo,todos,setTodos,setErrorMessage}=_ref;const[isEdit,setIsEdit]=useState(false);const[todoValue,setTodoValue]=useState(todo.title);const[shouldHandleBlur,setShouldHandleBlur]=useState(true);const inputRef=useRef(null);const handleCheckbox=()=>{updateTodoAPI(todo.id,{completed:!todo.completed}).then(()=>{const reverseStatus=prevTodos=>{return prevTodos.map(prevTodo=>{if(prevTodo.id===todo.id){return{...prevTodo,completed:!prevTodo.completed};}return prevTodo;});};setTodos(reverseStatus(todos));}).catch(()=>{setErrorMessage('Unable to update a todo status');});};const removeTodo=id=>{deleteTodo(id).then(()=>{setTodos(prevTodos=>prevTodos.filter(t=>t.id!==id));}).catch(()=>{setErrorMessage('Unable to delete a todo');});};useEffect(()=>{if(isEdit&&inputRef.current){inputRef.current.focus();}},[isEdit]);const handleDoubleClick=()=>{setShouldHandleBlur(true);setIsEdit(true);if(inputRef.current){inputRef.current.focus();}};const handleLabelChange=event=>{setTodoValue(event.target.value.trim()===''?'':event.target.value);};function updateTodo(){updateTodoAPI(todo.id,{title:todoValue}).then(()=>{const updatedTodos=todos.map(prevTodo=>{if(prevTodo.id===todo.id){return{...prevTodo,title:todoValue};}return prevTodo;});setTodos(updatedTodos);}).catch(()=>setErrorMessage('Unable to update title')).finally(()=>setIsEdit(false));}const handleLabelKeyDown=event=>{if(!todoValue.length&&event.key==='Enter'){removeTodo(todo.id);}if(todoValue.length&&event.key==='Enter'){event.preventDefault();updateTodo();}};const handleLabelKeyUp=event=>{if(event.key==='Escape'){setTodoValue(todo.title);setIsEdit(false);setShouldHandleBlur(false);}};const handleLabelBlur=()=>{if(shouldHandleBlur){if(!todoValue.length){removeTodo(todo.id);}else{updateTodo();}}};return/*#__PURE__*/_jsxs(\"div\",{\"data-cy\":\"Todo\",className:classNames('todo',{completed:todo.completed}),children:[/*#__PURE__*/_jsx(\"label\",{className:\"todo__status-label\",children:/*#__PURE__*/_jsx(\"input\",{\"data-cy\":\"TodoStatus\",type:\"checkbox\",className:\"todo__status\",checked:todo.completed,onChange:handleCheckbox})}),!isEdit&&/*#__PURE__*/_jsx(\"span\",{\"data-cy\":\"TodoTitle\",className:\"todo__title\",onDoubleClick:handleDoubleClick,children:todo.title}),!isEdit&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"todo__remove\",\"data-cy\":\"TodoDelete\",onClick:()=>removeTodo(todo.id),\"aria-label\":\"Delete\",children:\"\\xD7\"}),isEdit&&/*#__PURE__*/_jsx(\"form\",{children:/*#__PURE__*/_jsx(\"input\",{\"data-cy\":\"TodoTitleField\",type:\"text\",className:\"todo__title-field\",placeholder:\"Empty todo will be deleted\",value:todoValue,onChange:handleLabelChange,onKeyDown:handleLabelKeyDown,onKeyUp:handleLabelKeyUp,onBlur:handleLabelBlur,ref:inputRef})}),/*#__PURE__*/_jsxs(\"div\",{\"data-cy\":\"TodoLoader\",className:\"modal overlay\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-background has-background-white-ter\"}),/*#__PURE__*/_jsx(\"div\",{className:\"loader\"})]})]});};","map":{"version":3,"names":["useEffect","useRef","useState","classNames","deleteTodo","updateTodo","updateTodoAPI","jsx","_jsx","jsxs","_jsxs","TodoItem","_ref","todo","todos","setTodos","setErrorMessage","isEdit","setIsEdit","todoValue","setTodoValue","title","shouldHandleBlur","setShouldHandleBlur","inputRef","handleCheckbox","id","completed","then","reverseStatus","prevTodos","map","prevTodo","catch","removeTodo","filter","t","current","focus","handleDoubleClick","handleLabelChange","event","target","value","trim","updatedTodos","finally","handleLabelKeyDown","length","key","preventDefault","handleLabelKeyUp","handleLabelBlur","className","children","type","checked","onChange","onDoubleClick","onClick","placeholder","onKeyDown","onKeyUp","onBlur","ref"],"sources":["/Users/admin/Projects/TODO-app/src/components/TodoItem.tsx"],"sourcesContent":["import {\n  Dispatch,\n  SetStateAction,\n  useEffect, useRef, useState,\n} from 'react';\nimport classNames from 'classnames';\nimport { Todo } from '../types/Todo';\nimport {\n  deleteTodo, updateTodo as updateTodoAPI,\n} from '../api/todos';\n\ntype Props = {\n  todo: Todo,\n  todos: Todo[],\n  setTodos: Dispatch<SetStateAction<Todo[]>>,\n  setErrorMessage: Dispatch<SetStateAction<string>>,\n};\n\nexport const TodoItem: React.FC<Props> = ({\n  todo, todos, setTodos, setErrorMessage,\n}) => {\n  const [isEdit, setIsEdit] = useState(false);\n  const [todoValue, setTodoValue] = useState(todo.title);\n  const [shouldHandleBlur, setShouldHandleBlur] = useState(true);\n\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  const handleCheckbox = () => {\n    updateTodoAPI(todo.id, { completed: !todo.completed })\n      .then(() => {\n        const reverseStatus = (prevTodos: Todo[]) => {\n          return prevTodos.map((prevTodo) => {\n            if (prevTodo.id === todo.id) {\n              return { ...prevTodo, completed: !prevTodo.completed };\n            }\n\n            return prevTodo;\n          });\n        };\n\n        setTodos(reverseStatus(todos));\n      })\n      .catch(() => {\n        setErrorMessage('Unable to update a todo status');\n      });\n  };\n\n  const removeTodo = (id: number) => {\n    deleteTodo(id)\n      .then(() => {\n        setTodos((prevTodos) => prevTodos.filter(t => t.id !== id));\n      })\n      .catch(() => {\n        setErrorMessage('Unable to delete a todo');\n      });\n  };\n\n  useEffect(() => {\n    if (isEdit && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEdit]);\n\n  const handleDoubleClick = () => {\n    setShouldHandleBlur(true);\n    setIsEdit(true);\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  const handleLabelChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setTodoValue(event.target.value.trim() === '' ? '' : event.target.value);\n  };\n\n  function updateTodo() {\n    updateTodoAPI(todo.id, { title: todoValue })\n      .then(() => {\n        const updatedTodos = todos.map((prevTodo) => {\n          if (prevTodo.id === todo.id) {\n            return { ...prevTodo, title: todoValue };\n          }\n\n          return prevTodo;\n        });\n\n        setTodos(updatedTodos);\n      })\n      .catch(() => setErrorMessage('Unable to update title'))\n      .finally(() => setIsEdit(false));\n  }\n\n  const handleLabelKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (!todoValue.length && event.key === 'Enter') {\n      removeTodo(todo.id);\n    }\n\n    if (todoValue.length && event.key === 'Enter') {\n      event.preventDefault();\n      updateTodo();\n    }\n  };\n\n  const handleLabelKeyUp = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === 'Escape') {\n      setTodoValue(todo.title);\n      setIsEdit(false);\n      setShouldHandleBlur(false);\n    }\n  };\n\n  const handleLabelBlur = () => {\n    if (shouldHandleBlur) {\n      if (!todoValue.length) {\n        removeTodo(todo.id);\n      } else {\n        updateTodo();\n      }\n    }\n  };\n\n  return (\n    <div\n      data-cy=\"Todo\"\n      className={classNames('todo', {\n        completed: todo.completed,\n      })}\n    >\n      <label\n        className=\"todo__status-label\"\n      >\n        <input\n          data-cy=\"TodoStatus\"\n          type=\"checkbox\"\n          className=\"todo__status\"\n          checked={todo.completed}\n          onChange={handleCheckbox}\n        />\n      </label>\n\n      {!isEdit && (\n        <span\n          data-cy=\"TodoTitle\"\n          className=\"todo__title\"\n          onDoubleClick={handleDoubleClick}\n        >\n          {todo.title}\n        </span>\n      )}\n\n      {!isEdit && (\n        <button\n          type=\"button\"\n          className=\"todo__remove\"\n          data-cy=\"TodoDelete\"\n          onClick={() => removeTodo(todo.id)}\n          aria-label=\"Delete\"\n        >\n          Ã—\n        </button>\n      )}\n\n      {isEdit && (\n        <form>\n          <input\n            data-cy=\"TodoTitleField\"\n            type=\"text\"\n            className=\"todo__title-field\"\n            placeholder=\"Empty todo will be deleted\"\n            value={todoValue}\n            onChange={handleLabelChange}\n            onKeyDown={handleLabelKeyDown}\n            onKeyUp={handleLabelKeyUp}\n            onBlur={handleLabelBlur}\n            ref={inputRef}\n          />\n        </form>\n      )}\n\n      <div\n        data-cy=\"TodoLoader\"\n        className=\"modal overlay\"\n      >\n        <div className=\"modal-background has-background-white-ter\" />\n        <div className=\"loader\" />\n      </div>\n\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}